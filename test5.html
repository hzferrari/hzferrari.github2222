
<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>尝试打开APP的DEMO</title>
<link rel="stylesheet" href="/asserts/css/xmsCore.css" type="text/css" />
<style>
    body{
        padding:5%;
    }

    .remark{
        margin-top:1em;
        color:#ababab;
    }
</style>
</head>
<body>
    <h1>尝试打开APP的DEMO</h1>
    <div class = "custom-border border-color">
        <a id = "tryOpenApp" href = "#">尝试打开和彩云app</a>
    </div>
    <div class = "remark">如果已安装和彩云则打开，未安装则打开下载页</div>

<script type="text/javascript" src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="/js/jquery.js"></script>
<script>
    $(function () {

        function _openAppUrl(appUrl){
            var ua = navigator.userAgent.toLocaleLowerCase(),
                deviceVersion = 0,
                matchVersion = null,
                openAppType = "",
                // downLoadUrl = 'http://caiyun.feixin.10086.cn:7070/portal/mobile.jsp';
                downLoadUrl = 'https://itunes.apple.com/app/id544673497';
          
            //如果是在微信内部点击的时候
            if(ua.indexOf("micromessenger") != -1 ){
                _openAppUrl = function(){
                    alert("请点击右上角用浏览器查看！");
                }
            }else{
                //在浏览器打开，判断是在移动端还是在PC端
                if(matchVersion = navigator.userAgent.match(/OS\s*(\d+)/)){
                    //赋值，并且判断
                    //IOS设备的浏览器
                    deviceVersion = matchVersion[1] || 0;
          
                    if(deviceVersion - 9 >= 0){
                        openAppType = "newType";
                    }
                }else if(matchVersion = navigator.userAgent.match(/Android\s*(\d+)/)){

                    //Android的设备
                    deviceVersion = matchVersion[1] || 0;

        // alert(navigator.userAgent);
        // alert(matchVersion);
        // alert(deviceVersion);


                    if(deviceVersion - 5 >= 0){
                        openAppType = "newType";
                    }
                }else{
                    //PC端的设备
                    openAppType = "pc";
                }
          
                if(openAppType == "pc"){
                    _openAppUrl = function(){
                        alert("DEMO，请在移动端的浏览器查看！");
                    }
                }else if(openAppType == "newType"){

                    _openAppUrl = function(url){

                        function _show(){
                            // window.open(downLoadUrl); //在新建窗口中打开链接
                            window.location.href = downLoadUrl; //在当前窗口中打开链接
                        }
          
                        _openAppUrl = function(url){
                            location.href = url;
                            setTimeout(function(){
                                _show();
                            },2000);
                            
                        }
          
                        _openAppUrl(url);
          
                    }
                }
            }     
            _openAppUrl(appUrl);
        }
      
        var appUrl = "mcloud://";
        // var appUrl = "hecaiyun://launch";//安卓客户端拉起链接
      
        $("#tryOpenApp").on("click",function(){
            _openAppUrl(appUrl);
            return false;
        });
    	
    });
</script>
</body>
</html>
